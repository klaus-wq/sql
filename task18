1. Сначала выбираются поля из таблицы FORTRESS
2. Затем создаётся JSON объект, в который включены массивы идентификаторов гномов, ресурсов, мастерских и отрядов (связанные сущности).
Получим пару: сущность - массив значений.
3. JSON_ARRAYAGG - функция, с помощью которой можно объединить значений в один JSON-массив.